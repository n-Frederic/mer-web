<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>发布任务 - 潘多拉工作日志管理系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/theme.css">
    <style>
        body { align-items: flex-start; }
        .layout { width: 100%; max-width: 1100px; margin: 32px auto; padding: 0 40px; }
        .topbar { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .brand { display: flex; align-items: center; gap: 12px; }
        .brand .logo { width: 48px; height: 48px; margin: 0; }
        .brand strong { font-size: 20px; font-family: 'ZCOOL KuaiLe', 'Noto Sans SC', sans-serif; }
        .avatar { width: 40px; height: 40px; border-radius: 50%; background: radial-gradient(circle at 30% 30%, var(--color-peach), var(--color-primary-2)); border: 2px solid #fff; box-shadow: 0 3px 10px rgba(255,138,0,0.25); }
        .panel { background: #fff; border-radius: 14px; padding: 18px; }
        .nav-links { display:flex; gap:10px; }
        .nav-links a { padding:8px 12px; border-radius:10px; background:#fff7ef; border:1px solid #ffd3a1; color:#a55b00; text-decoration:none; }
        .nav-links a:hover { background:#ffe9d2; }
        .form { display:grid; grid-template-columns: 1fr 1fr; gap: 14px; }
        .form .full { grid-column: span 2; }
        .form-item { display:flex; flex-direction: column; gap:6px; }
        .form-item label { color:#7a5a33; font-size:15px; }
        .form-item input, .form-item textarea, .form-item select { padding:12px 14px; border:1px solid #ffd3a1; border-radius:10px; background:#fff; }
        .form-item textarea { min-height: 120px; resize: vertical; }
        .actions { display:flex; justify-content:center; gap:12px; margin-top: 8px; }
        .btn-sm { padding:10px 14px; border-radius:10px; background: linear-gradient(to right, var(--color-primary), var(--color-primary-2)); color:#fff; border:none; cursor:pointer; }
        .btn-secondary { padding:10px 14px; border-radius:10px; border:1px solid #ffd3a1; background:#fff; color:#a55b00; cursor:pointer; }
        .tips { color:#7a5a33; font-size: 13px; margin-top: 10px; text-align:center; }
        
        /* 用户选择模态框样式 */
        .user-modal { display:none; position:fixed; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; backdrop-filter:blur(5px); }
        .user-modal-content { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); background:#fff; border-radius:16px; padding:24px; width:90%; max-width:600px; max-height:80vh; overflow-y:auto; box-shadow:0 20px 40px rgba(0,0,0,0.3); }
        .user-modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; padding-bottom:12px; border-bottom:2px solid #ffd3a1; background:linear-gradient(135deg, #ff8a00 0%, #ff6b00 100%); margin:-24px -24px 0 -24px; padding:20px 24px; border-radius:16px 16px 0 0; }
        .user-modal-header h3 { margin:0; color:#fff; font-size:16px; font-weight:600; }
        .user-modal-close { cursor:pointer; color:#fff; font-size:24px; line-height:1; opacity:0.8; }
        .user-modal-close:hover { opacity:1; }
        .user-list { max-height:450px; overflow-y:auto; }
        .user-item { display:flex; align-items:center; justify-content:space-between; padding:12px 14px; margin-bottom:6px; border:1px solid #ffd3a1; border-radius:10px; cursor:pointer; transition:all 0.15s; }
        .user-item:hover { background:#fff7ef; border-color:#ff8a00; transform:translateX(2px); }
        .user-item.selected { background:#ffe9d2; border-color:#ff8a00; border-width:2px; padding:11px 13px; }
        .user-info { flex:1; }
        .user-name { font-weight:600; color:#333; margin-bottom:6px; font-size:15px; }
        .user-meta { font-size:12px; color:#666; line-height:1.6; }
        .user-check { width:22px; height:22px; border:2px solid #ffd3a1; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:14px; }
        .user-item.selected .user-check { background:#ff8a00; border-color:#ff8a00; color:#fff; }
        .selected-users-container { margin-top:8px; }
        .user-tag { display:inline-flex; align-items:center; gap:6px; padding:6px 12px; background:#ffe9d2; color:#a55b00; border-radius:8px; font-size:13px; margin:4px 4px 4px 0; }
        .user-tag-remove { cursor:pointer; font-weight:bold; opacity:0.7; }
        .user-tag-remove:hover { opacity:1; }
        
        /* 分页控件样式 */
        .user-pagination {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin: 16px 0;
        }
        .btn-pagination {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid #ffd3a1;
            background: white;
            color: #ff8a00;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .btn-pagination:hover:not(:disabled) {
            background: #fff7ef;
            border-color: #ff8a00;
            transform: scale(1.05);
        }
        .btn-pagination:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }
        .page-info {
            color: #666;
            font-size: 13px;
            font-weight: 500;
            padding: 0 8px;
        }
    </style>
</head>
<body>
    <div class="layout">
        <div class="topbar">
            <div class="brand">
                <div class="logo" style="width: 48px; height: 48px; background: linear-gradient(135deg, #ff8a00 0%, #ffb06b 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(255, 138, 0, 0.3); overflow: hidden; padding: 4px;">
                    <img src="data/picture/LOGO.png" alt="Logo" style="width: 100%; height: 100%; object-fit: contain;">
                </div>
                <strong>发布任务</strong>
            </div>
            <div style="display:flex; align-items:center; gap:16px;">
                <nav class="nav-links">
                    <a href="dashboard.html">工作日志</a>
                    <a href="users.html">用户管理</a>
                    <a href="tasks.html">任务展示</a>
                    <a href="calendar.html">统计周报</a>
                    <a href="profile.html">个人信息</a>
                </nav>
                <div class="profile" onclick="location.href='profile.html'" style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                    <span id="currentUserName">用户</span>
                    <div class="avatar"></div>
                </div>
            </div>
        </div>

        <div class="panel">
            <h3 style="text-align:center;">新增任务</h3>
            <form id="publishForm" class="form">
                <div class="form-item full">
                    <label>任务标题 <span style="color:red;">*</span></label>
                    <input id="pf_title" placeholder="例如：设计新的登录页面" required>
                </div>
                <div class="form-item full">
                    <label>任务描述 <span style="color:red;">*</span></label>
                    <textarea id="pf_description" placeholder="请输入详细的任务描述..." required></textarea>
                </div>
                <div class="form-item">
                    <label>截止时间 <span style="color:red;">*</span></label>
                    <input id="pf_dueAt" type="datetime-local" required>
                </div>
                <div class="form-item">
                    <label>优先级 <span style="color:red;">*</span></label>
                    <select id="pf_priority" required>
                        <option value="">请选择优先级</option>
                        <option value="Low">低</option>
                        <option value="Medium">中</option>
                        <option value="High">高</option>
                        <option value="Urgent">紧急</option>
                    </select>
                </div>
                <div class="form-item full">
                    <label>标签（可选，多个标签用逗号分隔）</label>
                    <input id="pf_tags" placeholder="例如：Q4, finance, urgent">
                </div>
                <div class="form-item full">
                    <label>指派成员 <span style="color:red;">*</span></label>
                    <button type="button" class="btn-secondary" onclick="showUserSelector()" style="width:100%; padding:12px; margin-bottom:8px;">
                        <i class="fas fa-users"></i> 选择成员
                    </button>
                    <input id="pf_assigneeIds" type="hidden" required>
                    <div id="selectedUsers" class="selected-users-container"></div>
                </div>
                <div class="actions full">
                    <button type="submit" class="btn-sm" id="btnPublish">
                        <i class="fas fa-paper-plane"></i> 创建任务
                    </button>
                    <button type="button" class="btn-secondary" id="btnReset">
                        <i class="fas fa-redo"></i> 重置
                    </button>
                </div>
            </form>
            <div class="tips">
                <i class="fas fa-info-circle"></i> 成员表里只显示可指派成员！
            </div>
        </div>
    </div>

    <!-- 用户选择模态框 -->
    <div id="userModal" class="user-modal">
        <div class="user-modal-content">
            <div class="user-modal-header">
                <h3><i class="fas fa-user-check"></i> 选择指派成员（点击用户名进行选择）</h3>
                <span class="user-modal-close" onclick="closeUserSelector()">&times;</span>
            </div>
            
            <!-- 搜索框 -->
            <div style="margin:12px 0; padding:0 12px; border-bottom:1px solid #ffd3a1;">
                <div class="user-search-box" style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
                    <i class="fas fa-search" style="color:#ff8a00;"></i>
                    <input type="text" id="userSearchInput" placeholder="搜索员工ID或邮箱..." style="flex:1; padding:8px 12px; border:1px solid #ffd3a1; border-radius:8px; font-size:14px; outline:none;">
                    <button type="button" id="userSearchBtn" class="btn-search" onclick="searchUsers()" style="padding:8px 16px; background:#ff8a00; color:white; border:none; border-radius:8px; cursor:pointer; font-size:14px;">
                        <i class="fas fa-search"></i> 搜索
                    </button>
                    <button type="button" id="userClearBtn" class="btn-clear" onclick="clearSearch()" style="padding:8px 16px; background:#ddd; color:#666; border:none; border-radius:8px; cursor:pointer; font-size:14px; margin-left:8px;">
                        <i class="fas fa-times"></i> 清除
                    </button>
                </div>
            </div>
            
            <div id="userList" class="user-list" style="margin-top:12px;">
                <div style="text-align:center; padding:20px; color:#999;">
                    <i class="fas fa-spinner fa-spin"></i> 加载中...
                </div>
            </div>
            
            <!-- 分页控件 -->
            <div id="userPagination" class="user-pagination" style="display: none; margin-top:16px; padding-top:16px; border-top:1px solid #ffd3a1; display:flex; justify-content:center; align-items:center; gap:12px;">
                <button id="userPrevPage" class="btn-pagination" onclick="userPrevPage()" disabled>
                    <i class="fas fa-chevron-left"></i> 上一页
                </button>
                <span id="userPageInfo" class="page-info">第 1 / 1 页</span>
                <button id="userNextPage" class="btn-pagination" onclick="userNextPage()" disabled>
                    下一页 <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <div style="margin-top:16px; padding-top:16px; border-top:1px solid #ffd3a1; display:flex; justify-content:space-between; align-items:center;">
                <span id="selectedCount" style="color:#666; font-size:14px;">已选择 <strong style="color:#ff8a00;">0</strong> 人</span>
                <button type="button" class="btn-sm" onclick="confirmUserSelection()" style="padding:10px 24px;">
                    <i class="fas fa-check"></i> 确认选择
                </button>
            </div>
        </div>
    </div>

    <script src="js/common.js"></script>
    <script src="js/api.js"></script>
    <script src="js/publish.js"></script>
</body>
</html>


